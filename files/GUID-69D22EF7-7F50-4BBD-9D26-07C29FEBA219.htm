<!DOCTYPE html>

<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <meta name="product" content="SI">
      <meta name="release" content="2015">
      <meta name="book" content="GeneralUser">
      <meta name="created" content="2014-03-26">
      <meta name="topicid" content="GUID-69D22EF7-7F50-4BBD-9D26-07C29FEBA219">
      <meta name="indexterm" content="CrowdFX: walls as obstacles">
      <meta name="indexterm" content="CrowdFX: obstacles (walls)">
      <meta name="indexterm" content="CrowdFX: wall collision detection by actors">
      <meta name="indexterm" content="CrowdFX: wall exit points">
      <meta name="topic-type" content="concept">
      <title>Avoiding Collisions with Obstacles (Walls)</title>
      <link rel="stylesheet" type="text/css" href="../style/softimage.css"><script type="text/javascript" src="../scripts/ac_common.js"></script><script type="text/javascript" src="../scripts/utils/adsk.redirect.js"></script></head>
   <body height="100%">
      <div class="body_content" id="body-content"><span class="anchor_wrapper"><a name="GUID-69D22EF7-7F50-4BBD-9D26-07C29FEBA219"></a></span><div class="head">
            <h1>Avoiding Collisions with Obstacles (Walls)</h1>
         </div>
         <p><span class="anchor_wrapper"><a name="GUID-182FC1C8-7219-4F15-B659-D66180FD88CC"></a></span>   
         </p>
         <p><span class="anchor_wrapper"><a name="GUID-DE632403-6368-4814-966F-12BBA1A22E9B"></a></span>Obstacles in crowd simulations are known as walls, which are polygon mesh objects
            with specific ICE data that CrowdFX understands. 
         </p>
         <p><span class="anchor_wrapper"><a name="GUID-E420DE3D-F0DF-4151-8122-E0EDB46381F8"></a></span>You must draw the walls using the <span class="MenuCascade" id="GUID-B0C0D321-30E4-49EF-A18E-54349AECDFCC">Draw Wall</span> command described below - you can't use any other objects as walls. However, you
            can use walls as proxy objects to represent the real geometry for an obstacle object
            you want to use in the scene. You can group several walls together to reflect the
            general shape of the real obstacle's geometry. 
         </p><span class="anchor_wrapper"><a name="FIG_1FA6979B5500464FA94D63FA5A8ABBDE"></a></span><div class="figure-anchor"><img src="../images/GUID-E75298D4-11EF-4C61-B6DA-C0EDD5BFFF99-low.png"></div>
         <div class="section"><span class="anchor_wrapper"><a name="WS023556C5E04D53409E7E875671E8B309-0035"></a></span> 
            <h2><span class="anchor_wrapper"><a name="GUID-C91ED33E-4741-4F25-A057-CE913E815A4B"></a></span>Adding Walls to the Crowd Simulation
            </h2> 
            <p><span class="anchor_wrapper"><a name="GUID-2EFD882B-E2BE-4ECB-A281-FCC9495C2973"></a></span>To create a wall and add it to the current crowd simulation: 
            </p> <span class="anchor_wrapper"><a name="GUID-3EE12E39-D2AE-486F-BED7-7FB49381A3E3"></a></span><ol type="1" start="1">
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-B946A4F8-705E-45C7-A7AD-1A6B217503ED"></a></span>Make sure the Crowd model you want to use is the current crowd â€” see <span class="char_link"><a href="GUID-2D267577-4F1A-4200-AA77-A39890B357C7.htm#GUID-D59CC5D2-1F28-4887-820A-7EB3F1847356">Setting and Selecting the Current Crowd</a></span>. 
                  </p> 
               </li>
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-C8B361CE-0520-44B8-9AF7-481854077D3D"></a></span> Choose the <span class="MenuCascade" id="GUID-F32605AE-2FD5-48D4-BB0C-428C898A9852">CrowdFX <img src="../images/ac.menuaro.gif"> Crowd <img src="../images/ac.menuaro.gif"> Create <img src="../images/ac.menuaro.gif"> Draw Wall</span> command from the ICE toolbar. 
                  </p> 
               </li>
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-8226DEB2-94F0-4BD1-9095-8548C282E07C"></a></span>Draw a wall where you want it in the viewport. It stays on the XZ plane by default.
                     
                  </p> 
                  <p><span class="anchor_wrapper"><a name="GUID-73763134-1D46-45B8-974E-BD85CD1A21D1"></a></span>Press the Shift key while you're drawing the wall to interactively change its height.
                     
                  </p> 
               </li>
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-8C003147-CE20-47D9-A038-ADB4EDD582B3"></a></span>Set the parameters in the <span class="char_link"><a href="iceref_Set_Wall_Data.htm">Set Wall Data</a></span> property editor that appears. This is the Set Wall Data compound in the ICE tree
                     that is created for the wall object. 
                  </p> 
               </li>
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-F981B384-6A44-459E-9EB1-CF8D78D0DA11"></a></span>Repeat this process for each wall you want to draw. 
                  </p> 
               </li>
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-8DDCF0D9-A9B3-42A8-A2C8-38052B4FC93C"></a></span>You now can move and rotate each wall as you would a normal polygon object, and animate
                     its transformations if you like. To resize the wall, see the next section below. 
                  </p> 
               </li>
            </ol> 
            <p><span class="anchor_wrapper"><a name="GUID-44755BE0-B83A-49AD-80B0-6BEF5A5A3168"></a></span>If there is an uneven terrain, you may want to move the walls down in Y so that there's
               no spaces between them and the terrain. 
            </p> 
            <p><span class="anchor_wrapper"><a name="GUID-D0CD141B-BD7F-4F38-8A75-C2BC81E632E3"></a></span>The wall objects you create are added under the Walls_Root node and referenced in
               the Walls group in the Crowd model - see <span class="char_link"><a href="GUID-B28743FA-33EC-4DA3-877B-FA7E7FD97F68.htm">Anatomy of a Crowd Simulation</a></span>. 
            </p> 
            <p><span class="anchor_wrapper"><a name="GUID-E544D1D6-0FD6-4E5B-8460-5DDCA64109FF"></a></span>If you duplicate a wall object, its copy is automatically added under the Walls_Root
               node and referenced in the Walls group. You can then position it as you like and edit
               its properties in the Set Wall Data property editor. 
            </p> 
            <p><span class="anchor_wrapper"><a name="GUID-64839D94-DA71-4AF1-B45A-C425B620CE05"></a></span>To toggle the display of all walls in the Walls group, choose the <span class="MenuCascade" id="GUID-86DA7AAC-CD39-4E9D-9070-7D38D036FC09">CrowdFX <img src="../images/ac.menuaro.gif"> Crowd <img src="../images/ac.menuaro.gif"> Edit <img src="../images/ac.menuaro.gif"> Show/Hide Walls</span> command from the ICE toolbar. You can also select the Walls group and press the H
               key. 
            </p> 
            <div><span class="anchor_wrapper"><a name="GUID-05117816-1E03-4CE6-BD11-9902A78E7B85"></a></span><div class="note-note"><span class="label">NOTE:</span>Each wall object has an <span class="MenuCascade" id="GUID-932EF577-E2ED-4FFE-ADEA-35E8E6B06B45">ID</span> value of -1 that's defined in its <span class="MenuCascade" id="GUID-802BF310-64BF-446A-B84F-204E56C850A4">Set Wall Data</span> compound. You can change this ID value when you want to identify each wall for a
                  specific effect or behavior in the crowd simulation. 
               </div>
            </div> 
            <div class="section"><span class="anchor_wrapper"><a name="SECTION_489000DC5E584C2F95A78EE69A2CAD0E"></a></span> 
               <h3><span class="anchor_wrapper"><a name="GUID-84E21EEC-888B-4612-8160-2089B5CFE6B0"></a></span>Changing the Size of the Wall
               </h3> 
               <p><span class="anchor_wrapper"><a name="GUID-C4F8F5F4-51FB-4A72-B43E-C8E700C3797E"></a></span>You can control the size of the wall with the three <span class="MenuCascade" id="GUID-FC52A608-C9BA-43B3-B739-4E28EB6CA62D">Dimensions</span> parameters in the <span class="char_link"><a href="iceref_Set_Wall_Data.htm">Set Wall Data</a></span> compound. The exit points are placed at the ends of the wall along either the X or
                  Z axes, whichever one is the longest. 
               </p> 
               <p><span class="anchor_wrapper"><a name="GUID-E942F44B-6E25-43F4-B9E1-C3F9F36372A5"></a></span>Changing the wall's size with the normal Scale transform tool doesn't change the <span class="MenuCascade" id="GUID-4A3AE364-D6E1-46D8-BE60-E06F839E2B63">Dimensions</span> values. As a result, the position of the exit points is not updated to reflect the
                  wall's new size so the collision avoidance will be inaccurate. 
               </p> 
            </div> 
         </div>
         <div class="section"><span class="anchor_wrapper"><a name="SECTION_D766F7E3EED645DBBF7FF247CE6F231A"></a></span> 
            <h2><span class="anchor_wrapper"><a name="GUID-49629517-04A0-41C5-B635-B52A208E768F"></a></span>How the Actor Detects Walls
            </h2> 
            <p><span class="anchor_wrapper"><a name="GUID-6ECE9766-0B5A-4036-B40B-D2F8C911C65C"></a></span>  
            </p> 
            <p><span class="anchor_wrapper"><a name="GUID-708A0E66-849D-468B-90F7-7770ED1AEB62"></a></span>Actors use a simple collision detection process to avoid collisions with walls. A
               "seeing" ray is cast from the location of the actor's knee or shin area, which is
               determined by the height of the character. The range of the seeing ray is determined
               by the <span class="MenuCascade" id="GUID-C0BCB74C-CAF2-4DDD-A7EF-D82D093FC541">Wall Interaction Limit</span> distance value in the <span class="char_link"><a href="iceref_Initialize_Collision_Avoidance.htm">Initialize Collision Avoidance</a></span> compound. If a wall is within this limit, the actor considers it for potential collision
               and starts heading toward the closest exit point on the wall (left, right, or both
               sides). 
            </p> 
            <p><span class="anchor_wrapper"><a name="GUID-9C77CCB2-8F57-4AB5-B664-2BB66A83B1B2"></a></span>You usually want to set the <span class="MenuCascade" id="GUID-FCC9E5DE-CFCF-4BBF-AA7A-FD850D80A519">Wall Interaction Limit</span> value fairly high so that actors have plenty of time to move toward an exit point.
               For example, if you see a wall far ahead of you, you don't wait until you're at the
               wall to turn and walk around it! 
            </p> 
            <p><span class="anchor_wrapper"><a name="GUID-079F1258-C994-4878-AD9D-AE7AD7924265"></a></span>You can also add "thickness" around the actor to prevent it from getting too close
               to the wall (and other actors) â€” see <span class="char_link"><a href="GUID-D36B006B-501F-45C8-8655-B1C6535B74E8.htm#GUID-6983E317-2DDA-4E72-8984-651C0497D743">Creating a Buffer Around the Actors</a></span>. 
            </p> <span class="anchor_wrapper"><a name="FIG_33299CFD9801471A89BB4B435674303E"></a></span><div class="figure-anchor"><img src="../images/GUID-47A6FA5C-075C-4015-9D32-83B8B62DA00B-low.png"></div> 
            <p><span class="anchor_wrapper"><a name="GUID-E2E2CBCB-4D10-47B9-8E73-E3972A97CDB4"></a></span>Remember that if you have a goal defined (see <span class="char_link"><a href="GUID-1F99F61E-66A8-450A-9869-C82EE0E68935.htm">Moving Toward Goals</a></span>), the actors are ultimately trying to make their way to that goal. The exit point
               of any wall that's in the way is a "temporary" goal: once they get past the wall,
               they will continue on to their real goal. 
            </p> 
            <div class="section"><span class="anchor_wrapper"><a name="SECTION_8150C361CE184E9394855A94641954F4"></a></span> 
               <h3><span class="anchor_wrapper"><a name="GUID-961DD59B-986F-4A9E-B451-D7B896ADC933"></a></span>Changing the Height of the Actor's Seeing Ray
               </h3> 
               <p><span class="anchor_wrapper"><a name="GUID-180785E3-B559-479A-B9F0-B47075CCF4D2"></a></span>The seeing ray is set low on the body by default so that shorter walls can be detected,
                  but you can set it to the height you want. For example, if the wall is raised above
                  the ground, you can raise the seeing ray so that it can detect objects that are higher.
                  
               </p> 
               <p><span class="anchor_wrapper"><a name="GUID-322789FB-A53F-4120-B5CC-5D59DC8D1707"></a></span>To do this, open the <span class="char_link"><a href="iceref_Initialize_Collision_Avoidance.htm">Initialize Collision Avoidance</a></span> compound for editing. Then change the Scalar value that's used to multiply the actor's
                  size. For example, if you want the seeing ray to be at approximately waist height,
                  use a value of 0.5 (half the actor's height). 
               </p> <span class="anchor_wrapper"><a name="FIG_B0647BDF9F4F4463B9C50DE4E3A877FB"></a></span><div class="figure-anchor"><img src="../images/GUID-3F3170A5-F2A6-477E-9958-4E709787BCFF-low.png"></div> 
            </div> 
         </div>
         <div class="section"><span class="anchor_wrapper"><a name="SECTION_E9BEDBFA38E54E5E807F2ADF54265C54"></a></span> 
            <h2><span class="anchor_wrapper"><a name="GUID-A637BBBE-4C18-45C7-BE14-58DE539A637F"></a></span>Setting the Exit Points for the Walls
            </h2> 
            <p><span class="anchor_wrapper"><a name="GUID-92AE7BBB-C7CE-4ED3-9C9D-591AF8FB898F"></a></span>  
            </p> 
            <p><span class="anchor_wrapper"><a name="GUID-418D11CD-886F-4227-9191-B137C419B09D"></a></span> Exit points define where you want the actors to go to get around a wall: left, right,
               or either side of the wall. These are displayed as green lines protruding from the
               longest wall sides. Each wall must have at least one exit point. 
            </p> 
            <p><span class="anchor_wrapper"><a name="GUID-FFE4867A-2EDA-4617-B77F-529CA6895B8A"></a></span>You can define the wall's exit points in its <span class="char_link"><a href="iceref_Set_Wall_Data.htm">Set Wall Data</a></span> compound: 
            </p> <span class="anchor_wrapper"><a name="UL_D982456669D44A6DB94C0D02C0A63E7A"></a></span><ul>
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-9F4AEC9C-2355-44BE-A9AC-8CEF6C6B141B"></a></span>The exit points are placed at the ends of the wall along either the X or Z axes, whichever
                     one is the longest. 
                  </p> 
               </li>
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-E078F2B2-0BE7-45F7-8215-DEBEECF94DD1"></a></span>Select whether the <span class="MenuCascade" id="GUID-8E8ABD98-2E60-4E77-8B59-2AB972295BC6">Exit Points</span> are on the left, right, or both sides of the wall. 
                  </p> 
                  <p><span class="anchor_wrapper"><a name="GUID-DAE95E7B-CDE3-45FA-AE71-CAFAEC31AD94"></a></span> Left and right sides are determined by the direction of the actor in relation to
                     the wall; that is, selecting Left for the wall here is the actor's left side. 
                  </p> 
                  <p><span class="anchor_wrapper"><a name="GUID-C58818AF-E4F3-46A0-B88C-B1C6E66E60B2"></a></span>If both sides are selected, the actor will move toward the exit point that is closest
                     to it. 
                  </p> 
               </li>
               <li>Change the<span class="MenuCascade" id="GUID-334B55B3-36DB-4088-A2E7-B699D66D7859"> Push Factor</span> to determine how far (in Softimage units) the exit point is from the wall. Actors
                  will try to go around this point no matter how far it is from the wall. <span class="anchor_wrapper"><a name="FIG_4AE4A3A376414B7FB7D2E0D30C540AB2"></a></span><div class="figure-anchor"><img src="../images/GUID-2C4D6333-9B1F-4BA0-B787-429CAC83EC75-low.png"></div> 
               </li>
            </ul> 
         </div>
         <div class="section"><span class="anchor_wrapper"><a name="SECTION_316962A6DC2446E38AE31AF9863FE62B"></a></span> 
            <h2><span class="anchor_wrapper"><a name="GUID-9E51D586-716B-46F1-9BA3-386E3DFBFCA7"></a></span>Using Nulls as Exit Points
            </h2> 
            <p><span class="anchor_wrapper"><a name="GUID-711652B2-038F-4CC6-9C96-A9B18DAB81E4"></a></span>You can also create nulls and link them to the wall for the exit points, which lets
               you create custom wall setups, including a room that has only one exit point. You
               can move the null to any position you like to create a custom exit point. The null's
               size and shape don't make a difference for collision detection - the actors simply
               head toward the null's center. 
            </p> 
            <p><span class="anchor_wrapper"><a name="GUID-22C0A93D-62C3-415A-86AD-7C35B5D15A31"></a></span>To use nulls as exit points: 
            </p> <span class="anchor_wrapper"><a name="OL_40539687941E4B3FA13A1BA6F500CE56"></a></span><ol type="1" start="1">
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-945A4728-00E2-4B26-8DA4-FF27C3689920"></a></span>Create the nulls and position them around the walls where you want them to be used.
                     
                  </p> 
               </li>
               <li> 
                  <p><span class="anchor_wrapper"><a name="GUID-DC0BBD9D-9C89-445D-9527-07CFE2011D1D"></a></span>In the wall's <span class="char_link"><a href="iceref_Set_Wall_Data.htm">Set Wall Data</a></span> compound, do either of the following: 
                  </p> <span class="anchor_wrapper"><a name="UL_797459843BEE4E7EB4A1569C481D6074"></a></span><ul>
                     <li> 
                        <p><span class="anchor_wrapper"><a name="GUID-9B3C2F34-AB88-41E7-ADEC-24DB3BFC0A73"></a></span>Click the <span class="MenuCascade" id="GUID-6B4692D5-D279-46ED-95EB-535A0901D82C">Explorer</span> button beside <span class="MenuCascade" id="GUID-8FD8573A-2B37-4863-AF8C-BB4900C5C742">Exit Left/Right Null</span> and select the null from the list. 
                        </p> 
                        <p><span class="anchor_wrapper"><a name="GUID-44B75F18-2E5A-4118-8DDE-77C9B0CB9D3C"></a></span> Left and right sides are determined by the direction of the actor in relation to
                           the wall; that is, selecting a null for the Exit Left Null is the actor's left side.
                           
                        </p> 
                     </li>
                     <li> 
                        <p><span class="anchor_wrapper"><a name="GUID-3A85D184-C90E-4325-82E2-EF4C8A61B229"></a></span>Click the <span class="MenuCascade" id="GUID-6F83D4F7-92DD-44F2-B5AB-768F4BC4D629">Pick</span> button and select the appropriate null in the viewport. Right-click to end picking
                           mode. 
                        </p> 
                     </li>
                  </ul> 
               </li>
            </ol> 
            <p><span class="anchor_wrapper"><a name="GUID-923D5FB5-AFA3-4C8E-B87F-9860D856BBB3"></a></span>The null is linked to the exit point, and you can position the null where you like.
               
            </p> <span class="anchor_wrapper"><a name="FIG_1F062F98586A42E1BCB010135E454C9D"></a></span><div class="figure-anchor"><img src="../images/GUID-C06AC335-DC0D-4155-B302-BB5C59766781-low.png"></div> 
         </div>
         <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div><br><p class="footer-license-block"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank"><img alt="Creative Commons License" style="border-width: 0;" src="../images/ccLink.png"></a>&nbsp;<em>Except where otherwise noted, this work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>. Please see the <a href="http://autodesk.com/creativecommons" target="_blank">Autodesk Creative Commons FAQ</a> for more information.</em></p><br></div>
   </body>
</html>